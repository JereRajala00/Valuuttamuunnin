<!-- Author of this page is Tiitus. This page shows rounting from user location to Metropolia Karamalmi Campus in Espoo -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>About Us</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <style>
        .map {
            position: absolute;
            width: 50%;
            height: 50%;
        }
    </style>
</head>
<header></header>
<body>
<h1>Näin pääset Metropolian Karamalmin toimipisteelle:</h1>
<p style = "margin-top: 30px;" id = alertText></p>
<div id="map" class="map">
<script>
  const options = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };
  function openMap(pos) {

    const crd = pos.coords;
    var map = L.map('map');

    // Logs location data to console
    console.log('Your current position is:');
    console.log(`Latitude : ${crd.latitude}`);
    console.log(`Longitude: ${crd.longitude}`);
    console.log(`More or less ${crd.accuracy} meters.`);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    L.Routing.control({
        waypoints: [
        L.latLng(crd.latitude, crd.longitude),
        L.latLng(60.223890, 24.758295)
        ],
        routeWhileDragging: true,
        router: L.Routing.mapbox('pk.eyJ1IjoidGFhYW5rIiwiYSI6ImNrZm55bHV5MjJxbGEyeW8zd2kyamNucWcifQ.ZjrFICw6y2JIeQjNGQeraA'),
    }).addTo(map);
  }
  function error(err) {
    console.warn(`ERROR(${err.code}): ${err.message}`);
    //if user denies to give location, Sets routing from Helsinki Center to metropolia Karamalmi campus
    if (err = 'User denied Geolocation') {
      var map = L.map('map');
      alert("Sijaintia ei saatu. Salli selaimessasi sijainnin antaminen.");
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      L.Routing.control({
        waypoints: [
          L.latLng(60.167675, 24.942140),
          L.latLng(60.223890, 24.758295)
        ],
        routeWhileDragging: true,
        router: L.Routing.mapbox('pk.eyJ1IjoidGFhYW5rIiwiYSI6ImNrZm55bHV5MjJxbGEyeW8zd2kyamNucWcifQ.ZjrFICw6y2JIeQjNGQeraA'),

      }).addTo(map);
      const alertText = document.getElementById('alertText');
      alertText.innerText = 'Sijaintia ei saatu. Salli sijainnin antaminen.'
    }
  }

  navigator.geolocation.getCurrentPosition(openMap, error, options);
</script>

</div>
</body>
</html>